#!/usr/bin/env node
/**
 * Script to extract and format environment variables from .env file
 * for easy copying to Render dashboard
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const envPath = path.join(__dirname, '..', '.env');

// Environment variables needed for Render
const requiredVars = [
  'ANTHROPIC_API_KEY',
  'OPENAI_API_KEY',
  'SERP_API_KEY',
  'UNSPLASH_ACCESS_KEY',
];

const optionalVars = [
  'DATABASE_URL', // Usually auto-set by Render
  'SESSION_SECRET', // Usually auto-generated by Render
  'NODE_ENV', // Set in render.yaml
];

console.log('ðŸ” Environment Variables for Render\n');
console.log('='.repeat(60));
console.log('\nðŸ“‹ Copy these values to your Render dashboard:\n');
console.log('Render Dashboard Link:');
console.log('ðŸ‘‰ https://dashboard.render.com/web/iotd-reskin/env\n');
console.log('='.repeat(60));

if (!fs.existsSync(envPath)) {
  console.error('âŒ .env file not found at:', envPath);
  process.exit(1);
}

const envContent = fs.readFileSync(envPath, 'utf-8');
const envVars = {};

// Parse .env file
envContent.split('\n').forEach(line => {
  line = line.trim();
  if (line && !line.startsWith('#')) {
    const [key, ...valueParts] = line.split('=');
    if (key && valueParts.length > 0) {
      const value = valueParts.join('=').replace(/^["']|["']$/g, '');
      envVars[key.trim()] = value.trim();
    }
  }
});

console.log('\nâœ… REQUIRED Variables:\n');
requiredVars.forEach(key => {
  const value = envVars[key];
  if (value) {
    console.log(`Key: ${key}`);
    console.log(`Value: ${value}`);
    console.log('---');
  } else {
    console.log(`âš ï¸  ${key}: NOT SET`);
    console.log('---');
  }
});

console.log('\nðŸ“ OPTIONAL Variables (if you want to set them manually):\n');
optionalVars.forEach(key => {
  const value = envVars[key];
  if (value && !key.includes('DATABASE_URL') && !key.includes('SESSION_SECRET')) {
    console.log(`Key: ${key}`);
    console.log(`Value: ${value.substring(0, 20)}... (truncated)`);
    console.log('---');
  }
});

console.log('\n' + '='.repeat(60));
console.log('\nðŸ“‹ Quick Copy Format (for Render dashboard):\n');

requiredVars.forEach(key => {
  const value = envVars[key];
  if (value) {
    console.log(`${key}=${value}`);
  }
});

console.log('\n' + '='.repeat(60));
console.log('\nðŸ’¡ Instructions:');
console.log('1. Go to: https://dashboard.render.com/web/iotd-reskin/env');
console.log('2. Click "Add Environment Variable" for each variable above');
console.log('3. Copy the Key and Value from the output above');
console.log('4. Save changes (Render will auto-redeploy)');
console.log('\n');

